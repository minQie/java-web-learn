<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="60 seconds">
    <include resource="org/springframework/boot/logging/logback/defaults.xml" />
    <!-- jmx动态控制日志级别(springboot Admin) -->
    <!-- <jmxConfigurator/> -->

    <!-- 输出到控制台 -->
    <appender name ="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <!-- ?????????????????????????????????指定级别的相关原理？ -->
        <!-- 特别指定日志输出级别 -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <encoder>
            <pattern>
                <!--
                说明：%clr(xxx) xxx需要指定颜色的日志内容 {xxx} xxx为指定的颜色，默认日志格式如下：
                ${CONSOLE_LOG_PATTERN:-
                    %clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}}){faint}
                    %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta}
                    %clr(-&#45;&#45;){faint} %clr([%15.15t]){faint}
                    %clr(%-40.40logger{39}){cyan}
                    %clr(:){faint} %m%n
                    ${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}
                }
                 -->
                %clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(%4L) %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}
            </pattern>
        </encoder>
    </appender>

    <!-- 输出到文件（异步文件输出，详见下） -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 日志存放地址-->
        <File>D:\Working-Temp\study\logs\today.log</File>
        <encoder>
            <pattern>%date [%level] [%thread] %logger{60} [%file : %line] %msg%n</pattern>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- 日志后缀名添加".gz" 历史日志会启用压缩 -->
            <fileNamePattern>D:\Working-Temp\study\logs\%d{yyyy-MM-dd}.log</fileNamePattern>
            <!-- 保留30天日志 -->
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>

    <!-- 输出到文件：异步文件输出（单机环境下，效果应该不大） -->
    <appender name="ASYNC-FILE" class="ch.qos.logback.classic.AsyncAppender">
        <!-- 不丢失日志（默认队列80%已满，丢弃TRACE、DEBUG、INFO级别的日志） -->
        <discardingThreshold>0</discardingThreshold>
        <!-- 更改默认队列的深度，默认256（会影响性能） -->
        <queueSize>256</queueSize>
        <!-- 添加附加的appender，最多只能添加一个 -->
        <appender-ref ref="FILE"/>
    </appender>

    <!-- 指定特定包下日志输出级别 -->
    <logger name="priv.wmc" level="INFO" />

    <!-- 指定所有的appender -->
    <root level="INFO">
        <!-- ?????????????????????????????????这里可以指定level？ -->
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="ASYNC-FILE"/>
    </root>
</configuration>